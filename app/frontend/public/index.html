<!DOCTYPE html>
<html>
<head>
    <title>Git Time Diary</title>
    <link rel="icon" type="image/svg+xml" href="./img/favicon.svg" />

    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div id="login-section">
        <button id="github-login">Connect with GitHub</button>
    </div>
    
    <div id="main-section" style="display:none">
        <h1>Git Time Diary</h1>
        <div class="container"></div>
    </div>

    <!-- Ajout d'un div pour les messages d'erreur -->
    <div id="error-message" style="display:none; color: red; padding: 10px;"></div>

    <script>
        // Gestionnaire d'erreurs global
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            console.error('Error: ' + msg);
            console.error('URL: ' + url);
            console.error('Line: ' + lineNo);
            console.error('Column: ' + columnNo);
            console.error('Error object:', error);
            
            document.getElementById('error-message').textContent = 
                `Une erreur est survenue: ${msg}`;
            document.getElementById('error-message').style.display = 'block';
            return false;
        };

        // Gestionnaire pour les promesses rejetées non gérées
        window.addEventListener('unhandledrejection', function(event) {
            console.error('Unhandled promise rejection:', event.reason);
            document.getElementById('error-message').textContent = 
                `Erreur de promesse: ${event.reason}`;
            document.getElementById('error-message').style.display = 'block';
        });
    </script>

    <script type="module">
        console.log('Chargement des modules...');
        import { startOAuth } from './js/auth.js';
        console.log('Module auth.js chargé');
        
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM chargé');
            const loginButton = document.getElementById('github-login');
            if (loginButton) {
                console.log('Bouton de login trouvé');
                loginButton.addEventListener('click', () => {
                    console.log('Clic sur le bouton de login');
                    startOAuth();
                });
            } else {
                console.error('Bouton de login non trouvé');
            }
        });
    </script>

    <script type="module" src="js/auth.js"></script>
    <script type="module" src="js/main.js"></script>
    <script type="module" src="js/handler.js"></script>
    <script type="module" src="js/github.js"></script>
    <script type="module" src="js/time.js"></script>
    <script type="module" src="js/export.js"></script>
</body>
</html>